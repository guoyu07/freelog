<extend name="Index/base" />

<block name="main">
	<volist name="list" id="post" key="post_k">
		<assign name="tpl" value="$post.type"/>
		<switch name="tpl">
			<case value="text"><include file="Index/text" /></case>
			<case value="picture"><include file="Index/picture" /></case>
			<case value="music"><include file="Index/music" /></case>
			<case value="video"><include file="Index/video" /></case>
		</switch>
		<!-- <include file="$tpl" /> -->
	</volist>

	<nav>
		<ul class="pager">
			<li><a href="#">Previous</a></li>
			<li><a href="#">Next</a></li>
		</ul>
	</nav>
</block>

<block name="sidebar">
	<div class="sidebar-module sidebar-module-inset">
		<h4>About</h4>
		<p>Etiam porta <em>sem malesuada magna</em> mollis euismod. Cras mattis consectetur purus sit amet fermentum. Aenean lacinia bibendum nulla sed consectetur.</p>
	</div>
	<div class="sidebar-module">
		<h4>Archives</h4>
		<ol class="list-unstyled">
			<li><a href="#">March 2014</a></li>
			<li><a href="#">February 2014</a></li>
			<li><a href="#">January 2014</a></li>
			<li><a href="#">December 2013</a></li>
			<li><a href="#">November 2013</a></li>
			<li><a href="#">October 2013</a></li>
			<li><a href="#">September 2013</a></li>
			<li><a href="#">August 2013</a></li>
			<li><a href="#">July 2013</a></li>
			<li><a href="#">June 2013</a></li>
			<li><a href="#">May 2013</a></li>
			<li><a href="#">April 2013</a></li>
		</ol>
	</div>
	<div class="sidebar-module">
		<h4>Elsewhere</h4>
		<ol class="list-unstyled">
			<li><a href="#">GitHub</a></li>
			<li><a href="#">Twitter</a></li>
			<li><a href="#">Facebook</a></li>
		</ol>
	</div>
</block>

<block name="script">
	<script type="text/javascript" src="__BOWER__/audiojs/audiojs/audio.min.js"></script>

	<script src="__STATIC__/swipebox/js/jquery.swipebox.js"></script>
	<link rel="stylesheet" href="__STATIC__/swipebox/css/swipebox.css">

	<script type="text/javascript">
		$(function(){
			var single = audiojs;
			single.events.ready(function() {
				var a1 = single.createAll('', $('.single audio'));
			});

			var a = audiojs.createAll({
				trackEnded: function() {
					var next = $('ol li.playing').next();
					if (!next.length) next = $('ol li').first();
					next.addClass('playing').siblings().removeClass('playing');
					audio.load($('a', next).attr('data-src'));
					audio.play();
				}
			}, $('.multiple audio'));

			if(a.length){
				// Load in the first track
				var audio = a[0];
				first = $('ol a').attr('data-src');
				$('ol li').first().addClass('playing');
				audio.load(first);
				// Load in a track on click
				$('ol li').click(function(e) {
					e.preventDefault();
					$(this).addClass('playing').siblings().removeClass('playing');
					audio.load($('a', this).attr('data-src'));
					audio.play();
				});
				// Keyboard shortcuts
				$(document).keydown(function(e) {
					var unicode = e.charCode ? e.charCode : e.keyCode;
					 // right arrow
					 if (unicode == 39) {
							var next = $('li.playing').next();
							if (!next.length) next = $('ol li').first();
							next.click();
						// back arrow
					} else if (unicode == 37) {
						var prev = $('li.playing').prev();
						if (!prev.length) prev = $('ol li').last();
						prev.click();
						// spacebar
					} else if (unicode == 32) {
						audio.playPause();
					}
				});
			}

			//图片灯箱
			$( '.swipebox' ).swipebox();
		})
	</script>
</block>
